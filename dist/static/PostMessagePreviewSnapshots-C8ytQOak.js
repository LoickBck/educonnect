import{a9 as g,aa as P,r as s,cz as S,at as _,d1 as E,aT as k,d2 as x,d3 as M,d4 as R,d5 as D,b1 as F,bV as h,d0 as U,bq as $,bk as j,aF as y}from"./sanity-qCghvVMa.js";function I(c){return g(function(t,r){var i=!1,n=0;t.subscribe(P(r,function(a){return(i||(i=!c(a,n++)))&&r.next(a)}))})}const O=c=>{const{comlink:t,refs:r,perspective:i}=c,n=S(),a=_(),u=s.useMemo(()=>new E,[]),b=s.useMemo(()=>u.asObservable().pipe(k(d=>M(d.map(e=>{const f={...e,_id:R(e._id)},m=i==="previewDrafts"?n.observeForPreview(f,a.get(f._type)).pipe(D(),I(o=>o.snapshot===null)):F,v={...e,_id:h(e._id)},w=n.observeForPreview(v,a.get(v._type));return U(w.pipe($(m)),m).pipe(j(o=>!!o.snapshot),y(o=>{const p=o.snapshot;return{_id:h(p._id),title:p.title,subtitle:p.subtitle,description:p.description,imageUrl:p.imageUrl}}))}))),x(0)),[n,u,a,i]),l=s.useRef([]);return s.useEffect(()=>{const d=b.subscribe(e=>{t.post("presentation/preview-snapshots",{snapshots:e}),l.current=e});return()=>{d.unsubscribe()}},[t,b]),s.useEffect(()=>t.on("visual-editing/preview-snapshots",()=>({snapshots:l.current})),[t]),s.useEffect(()=>{u.next(r)},[r,u]),null};var V=s.memo(O);export{V as default};
